<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Upload with Persistent File List</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    ul { padding-left: 20px; }
    li { margin-bottom: 10px; }
  </style>
</head>
<body>

  <h2>📤 Admin Upload Files</h2>
  <input type="file" id="fileInput" multiple />
  <button id="clearBtn">🗑 Clear All Stored Files</button>

  <h3>📁 Uploaded Files:</h3>
  <ul id="fileList">Loading...</ul>

  <script>
    const fileInput = document.getElementById("fileInput");
    const fileList = document.getElementById("fileList");
    const clearBtn = document.getElementById("clearBtn");

    // Load files from localStorage
    const storedFiles = JSON.parse(localStorage.getItem("uploadedFiles") || "[]");

    // Recreate blob URLs for display
    storedFiles.forEach(file => {
      const byteArray = Uint8Array.from(atob(file.base64), c => c.charCodeAt(0));
      const blob = new Blob([byteArray], { type: file.type });
      const url = URL.createObjectURL(blob);
      addFileToList(file.name, url);
    });

    fileInput.addEventListener("change", () => {
      const files = Array.from(fileInput.files);

      files.forEach(file => {
        const reader = new FileReader();

        reader.onload = () => {
          const base64 = reader.result.split(',')[1]; // remove "data:*/*;base64," part

          // Save to localStorage
          const newFile = {
            name: file.name,
            type: file.type,
            base64: base64
          };

          storedFiles.push(newFile);
          localStorage.setItem("uploadedFiles", JSON.stringify(storedFiles));

          const blob = new Blob([file], { type: file.type });
          const url = URL.createObjectURL(blob);

          addFileToList(file.name, url);
        };

        reader.readAsDataURL(file);
      });

      fileInput.value = ""; // reset input
    });

    clearBtn.addEventListener("click", () => {
      localStorage.removeItem("uploadedFiles");
      fileList.innerHTML = "<em>No files uploaded.</em>";
    });

    function addFileToList(name, url) {
      const li = document.createElement("li");
      const a = document.createElement("a");
      a.href = url;
      a.textContent = `⬇️ ${name}`;
      a.download = name;
      li.appendChild(a);
      fileList.appendChild(li);
    }

    if (storedFiles.length === 0) {
      fileList.innerHTML = "<em>No files uploaded.</em>";
    }
  </script>

</body>
</html>
