<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Upload and Store Files (IndexedDB)</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    ul { padding-left: 20px; }
    li { margin-bottom: 10px; }
  </style>
</head>
<body>

  <h2>ğŸ“¤ Upload Files (Stored in Browser)</h2>
  <input type="file" id="fileInput" multiple />
  <button id="clearBtn">ğŸ—‘ Clear All Files</button>

  <h3>ğŸ“ Stored Files:</h3>
  <ul id="fileList">Loading...</ul>

  <script>
    // Open or create the IndexedDB
    const dbName = "FileStorageDB";
    let db;

    const openRequest = indexedDB.open(dbName, 1);

    openRequest.onupgradeneeded = (event) => {
      db = event.target.result;
      db.createObjectStore("files", { keyPath: "name" });
    };

    openRequest.onsuccess = (event) => {
      db = event.target.result;
      listFiles();
    };

    openRequest.onerror = (event) => {
      console.error("IndexedDB error:", event.target.error);
    };

    const fileInput = document.getElementById("fileInput");
    const fileList = document.getElementById("fileList");
    const clearBtn = document.getElementById("clearBtn");

    fileInput.addEventListener("change", () => {
      const files = Array.from(fileInput.files);
      const tx = db.transaction("files", "readwrite");
      const store = tx.objectStore("files");

      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = () => {
          const fileData = {
            name: file.name,
            type: file.type,
            data: reader.result
          };
          store.put(fileData);
        };
        reader.readAsArrayBuffer(file);
      });

      tx.oncomplete = () => {
        listFiles();
      };
    });

    clearBtn.addEventListener("click", () => {
      const tx = db.transaction("files", "readwrite");
      const store = tx.objectStore("files");
      const clearRequest = store.clear();
      clearRequest.onsuccess = () => {
        fileList.innerHTML = "<em>No files uploaded.</em>";
      };
    });

    function listFiles() {
      const tx = db.transaction("files", "readonly");
      const store = tx.objectStore("files");
      const request = store.getAll();

      request.onsuccess = () => {
        const files = request.result;
        fileList.innerHTML = "";

        if (files.length === 0) {
          fileList.innerHTML = "<em>No files uploaded.</em>";
          return;
        }

        files.forEach(file => {
          const blob = new Blob([file.data], { type: file.type });
          const url = URL.createObjectURL(blob);

          const li = document.createElement("li");
          const a = document.createElement("a");
          a.href = url;
          a.textContent = `â¬‡ï¸ ${file.name}`;
          a.download = file.name;
          li.appendChild(a);
          fileList.appendChild(li);
        });
      };
    }
  </script>

</body>
</html>
